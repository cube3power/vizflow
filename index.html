<!doctype html5>
<html>
  <head>
    <style>

      body { 

        margin: 0;
        font: 13pt courier;
        font-weight: bold;
        background-color: #FFF;
        overflow-y:hidden;
        color: #ccc;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;        

      }

    </style>

      <link rel="icon" href="./favicon.ico?v=1" />

      <meta charset="UTF-8">
      <meta name="viewport" content="initial-scale=1.0,width=device-width,maximum-scale=1,user-scalable=no,minimal-ui">
      <meta name="Election Fighter" content="Vizflow is an ES6 render-loop library">

      <title>Vizflow</title>

      <meta name="vizflow" content="ES6 render-loop library" />

      <!-- Twitter Card data -->
      <meta name="twitter:card" value="Vizflow: ES6 render-loop library">

      <!-- Open Graph data -->
      <meta property="og:title" content="Vizflow is a general purpose ES6 render loop library" />
      <meta property="og:type" content="website" />
      <meta property="og:url" content="http://vizflow.org" />
      <meta property="og:image" content="http://vizflow.org/thumbnail.png" />
      <meta property="og:description" content="Vizflow is an ES6 render-loop library for adding interactive visualizations to HTML5 apps" />

    </head>
  <body>

    <!-- <script type="text/javascript" src="jspm_packages/system.js"></script> -->
    <!-- <script type="text/javascript" src="config.js"></script> -->

    <script type="text/javascript" src="vizflow.js"></script>
    <script type="text/javascript" src="vizflow-helper.js"></script>

    <!-- <script type="text/javascript" src="examples/three_circles_svg/three_circles_svg.js"></script>-->
    
    <script>

      document.example      = ['three_circles_svg', 'ph_game', 'electionfighter', 'primefruit'] ;
      document.exampleImage = document.example.map(function(d) { return './image/' + d + '.png' ; }) ;
      document.image        = ['./image/vizflow_text.png', './image/vizflow_url.png'] ;
      document.imageList    = document.image.concat(document.exampleImage) ;
      document.audioList    = [] ;

      $Z.helper.loader.all(document.imageList, document.audioList, vizflow_page) ;

      function vizflow_page() {

        // console.log('vizflow page start') ;

        document.ratio = 1 ;

        var vtxt = ['v', 'i', 'z', 'f', 'l', 'o', 'w'] ;
        var size = 102 ;
        var spriteImage = $Z.helper.image.to_canvas( document.imageList[0] ) ;
        spriteImage.clear_color([255, 255, 255]) ;

        var viz = $Z.helper.viz.setup({
          width:  800,
          height: 800,
          fadeDuration: 400,
        }) ;

        document.viz = viz ;

        viz.Nspin    = 7 ;
        viz.tSpin    = 400 ;
        viz.longDur  = viz.delay * (2 + vtxt.length * 2) ;
        viz.xdelay   = 0.7 ;
        viz.movedur  = 1000 ;
        viz.flashDur = 200 ;
        viz.delay    = 100 ;
        viz.spinDur  = viz.Nspin * viz.tSpin ;
        viz.fadeDur  = 1000 ;

        viz.run() ;

        viz.logo = {

          text: vtxt,
          sprite: $Z.helper.sprite.get( spriteImage, vtxt, size, size ),
          item: new Array( vtxt.length ),

        } ;

        viz.examples = function vizflow_examples() {          

          viz.example = new Array(document.example.length) ;

          var yShift  = 0.25 ;
          var xShift  = 0.25 ;
          var yOff    = 188 ;

          var xList   = [viz.width * 0.5, viz.width * (0.5 - xShift), viz.width * (0.5 + xShift), viz.width * 0.5] ;
          var yList   = [yOff, viz.height * (0.5 - yShift) + yOff, viz.height * (0.5 - yShift) + yOff, viz.height * 0.5 + yOff] ;

          var urlList = [
            'http://vizflow.org/three_circles_svg/',
            'http://vizflow.org/ph_game/', 
            'http://electionfighter.com/',
            'http://vizflow.org/primefruit/',
          ] ;

          for (var kex = 0 ; kex < document.example.length ; kex++) {

            var imageK = $Z.helper.image.to_canvas( document.exampleImage[kex] ) ;
            var url    = urlList[kex] ;

            viz.example[kex] = viz.setup_item({

              image: imageK,
              x: xList[kex] - imageK.width * 0.5,
              y: yList[kex] - imageK.height * 0.5,
              uiSwitch: true,

              callback: function() {
                // console.log('callback', 'url', url) ;
                window.open(url) ;
              },

              addSwitch: true,
              opacity: 0,

            }) ;

            viz.example[kex].fade() ;

          }

          var urlImage = $Z.helper.image.to_canvas(document.imageList[1]) ;

          viz.url = viz.setup_item({
            image: urlImage,
            x: viz.width * 0.5,
            y: viz.height - urlImage.height * 3,
            xOrigin: urlImage.width * 0.5,
            yOrigin: urlImage.height * 0.5,
            xScale: 2.5,
            yScale: 2.5,
            uiSwitch: true,
            addSwitch: true,
            callback: function() {
              var vizflowUrl = 'https://github.com/vizflow/vizflow' ;
              window.open(vizflowUrl) ;
            },
          }) ;

          viz.setup_ui() ;

        } ;

        var xOrigin = 0.5 * size ;
        var yOrigin = 0.5 * size ;
        var xmid    = viz.width  * 0.5 ;
        var ymid    = viz.height * 0.5 ; 
        var x0      = ( viz.width - spriteImage.height ) * 0.5 + xOrigin ;
        var y0      = ymid ;
        var xpad    =  10 ;
        var xoff1   = -xpad * 2 ;   // shift the "i" relative to "v" 
        var xoff2   = -2.5 * xpad ; // shift more letters
        var xoff3   =  0.5 * xpad ; // shift the letters some more 

        function upper_left(item) {

          if ( item === undefined ) {
            item = this ;
          }

          var scale  = 0.5 ;
          var xScale = scale ;
          var yScale = scale ;
          var xpad   = 0 ;
          var ypad   = -160 ;
          var x1     = xpad + scale * item.x ; 
          var y1     = ypad + scale * item.y ; 

          item.add_linear('xScale', xScale, viz.movedur) ;
          item.add_linear('yScale', yScale, viz.movedur) ;
          item.add_linear('x', x1, viz.movedur) ;
          item.add_linear('y', y1, viz.movedur) ;

        }

        function fade_switch(item) {
          
          if (item === undefined) {
            item = this ;
          }

          var trans = item.viz.fader([1, 0]) ;
          trans.end = function() {
            item.image = item.viz.logo.sprite[item.config.txt][1] ;
          }

          trans.child.end = function() {
            viz.examples() ;
          }

          item.white.add_transition(trans) ;

        }

        for ( ktxt = vtxt.length - 1 ; ktxt >= 0 ; ktxt-- ) {

          var x = x0 + ktxt * (size + xpad) ;

          if ( ktxt > 0 ) {
            x += xoff1 ;
          }

          if ( ktxt > 1 ) {
            x += xoff2 ;
          }

          if ( ktxt > 2 ) {
            x += xoff3 ;
          }

          viz.logo.item[ktxt] = viz.setup_item({

            image: viz.logo.sprite[viz.logo.text[ktxt]][0],
            x: x,
            y: y0,
            xOrigin: xOrigin,
            yOrigin: yOrigin,
            addSwitch: true,
            opacity: 0,
            k: ktxt,
            txt: vtxt[ktxt],

          }) ;

          viz.logo.item[ktxt].upper_left  = upper_left ;
          viz.logo.item[ktxt].fade_switch = fade_switch ;
          viz.logo.item[ktxt].default_child() ;

        }

        var endAngle   = Math.PI * 2 * viz.Nspin ;
        var angle_func = $Z.helper.transition.fixed_duration('angle', viz.spinDur) ;
        var spinTrans  = angle_func(endAngle) ;

        spinTrans.power = 0.25 ; 

        spinTrans.end = function () {
          viz.logo.item.forEach(function(d, i) {

            if ( i === 2 ) {
              return ; // z fades in first
            }

            d.call('fade', i * viz.delay) ;

          }) ;

          viz.call(homepage, viz.logo.item.length * viz.delay + viz.longDur) ;
        
        } // ** end: spinTrans.end **

        var z = viz.logo.item[2] ; 

        z.x = viz.width * 0.5 ;
        z.add_transition(spinTrans) ;
        z.fade({
          duration: viz.fadeDur,
          opacity: 1,
        })

        z.call(
          function() { z.add_linear('x', z.config.x, (1 - viz.xdelay) * viz.spinDur) ; }, 
          viz.spinDur * viz.xdelay
        ) ;

        function homepage() {
          viz.logo.item.forEach(function(d, i) {
            d.call('upper_left', viz.fadeDur + i * viz.delay) ;
            d.call('fade_switch', (8 + viz.logo.item.length) * viz.delay + viz.movedur) ;
          }) ;
        }
      
      }

    </script>

    <script type="text/javascript" src="analytics.js"></script>    

  </body>
</html>
